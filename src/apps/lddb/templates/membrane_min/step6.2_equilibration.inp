* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) on Aug, 19. 2013.
* INPUT FILES FOR EQUILIBRATION
*

! Read topology and parameter files
stream toppar.str

! Read the system information
stream step3_size.str
stream step6.1_equilibration.str

! Read PSF and Coordinates
open read unit 10 card name step5_assembly.psf
read psf  unit 10 card

open read unit 10 card name step5_assembly.crd
read coor unit 10 card

!
! Image Setup
!

open read unit 10 card name crystal_image.str
CRYSTAL DEFINE @XTLtype @A @B @C @alpha @beta @gamma
CRYSTAL READ UNIT 10 CARD

!Image centering by residue
IMAGE BYRESID XCEN 0.0 YCEN 0.0 ZCEN @zcen sele resname TIP3 .or. segid MEMB end
IMAGE BYRESID XCEN 0.0 YCEN 0.0 ZCEN @zcen sele resname @posid .or. resname @negid end

!
! Nonbonded Options
!

nbonds atom vatom vfswitch bycb -
       ctonnb 10.0 ctofnb 12.0 cutnb 16.0 cutim 16.0 -
       inbfrq -1 imgfrq -1 wmin 1.0 cdie eps 1.0 -
       ewald pmew fftx @fftx ffty @ffty fftz @fftz  kappa .34 spline order 6
energy

! 
! Equilibration (change "nstep" to reduce the number of dynamics steps)
! 

define PROT sele segid PROA end
define BB   sele ( type C .or. type O .or. type N  .or. type CA ) .and. PROT end
define SC   sele .not. BB .and. .not. hydrogen .and. PROT end

cons harm force 5.0 sele BB end
cons harm force 2.5 sele SC end

set wforce = 2.5   ! force constant to keep the water molecules away from the hydrophobic core
set tforce = 2.5   ! force constant to keep the lipid tail below +/- %
set mforce = 2.5   ! force constant to keep the lipid head groups close to target values

stream membrane_lipid_restraint.str

set fcis   =  100  ! dihedral restraint force constant to keep the cis double bonds
set fc2    =  100   ! dihedral restraint force constant to keep the c2  chirality

stream membrane_lipid_restraint2.str

! 
! Equilibration
!------------------------------------------------------------------------
! To reduce the possible problem with the numerical integration with
! the uncorrelated system, 1 fs time-step is used only for the first-step of 
! equilibration. 
! It is still possible that you may need to use 1 fs for the next equilibration
! steps if your system is initially very very unstable (rare cases).
!
! ** Note: change "nstep" to reduce the number of dynamics steps
!

set nstep = 25000

! estimate Pmass from SYSmass (total system mass)
! [there could be problems with exreme values, such as  Pmass << SYSmass or Pmass >> SYSmass 
scalar mass stat
calc Pmass = int ( ?stot  /  50.0 )

set temp = 303.15
SHAKE BONH PARAm TOL 1.0e-6
scalar fbeta set 3.0 select .not. type H* end

open read  unit 11 card name step6.1_equilibration.rst
open write unit 12 card name step6.2_equilibration.rst

DYNA LANGEVIN -
     restart        nstep  @nstep  timestp 0.001  -
     inbfrq    -1  imgfrq     -1  ihbfrq      0  ilbfrq      0 -
     firstt @temp  finalt  @temp  tstruc  @temp  -
     tbath  @temp  rbuf      0.0  -
     iunread   11  iunwrite   12  iuncrd     -1  iunvelo    -1 -
     nsavc      0  nsavvelo    0  -
     nprint  1000  iprfrq   1000  isvfrq   1000  ntrfrq   5000 -
     iasvel     1

!
! write some infromation
!

open write unit 10 card name step6.2_equilibration.pdb
write coor unit 10 pdb
close unit 10

open write unit 10 card name step6.2_equilibration.crd
write coor unit 10 card
close unit 10

stop